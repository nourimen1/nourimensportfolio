[build]
  command = "npm run build"
  publish = "build/client"

[functions]
  directory = "netlify/functions"
  node_bundler = "esbuild"

[build.environment]
  NODE_VERSION = "20"
  NETLIFY = "true"

# CRITICAL FIX: Static files must be served FIRST, before the catch-all redirect
# Use explicit rules for static paths that tell Netlify NOT to redirect them

# These rules explicitly handle static files by rewriting to themselves
# This prevents the catch-all from intercepting them
[[redirects]]
  from = "/icon-*"
  to = "/icon-:splat"
  status = 200
  force = false

[[redirects]]
  from = "/shortcut.png"
  to = "/shortcut.png"
  status = 200
  force = false

[[redirects]]
  from = "/favicon.*"
  to = "/favicon.:splat"
  status = 200
  force = false

[[redirects]]
  from = "/humans.txt"
  to = "/humans.txt"
  status = 200
  force = false

[[redirects]]
  from = "/robots.txt"
  to = "/robots.txt"
  status = 200
  force = false

[[redirects]]
  from = "/sitemap.xml"
  to = "/sitemap.xml"
  status = 200
  force = false

[[redirects]]
  from = "/manifest.json"
  to = "/manifest.json"
  status = 200
  force = false

[[redirects]]
  from = "/assets/*"
  to = "/assets/:splat"
  status = 200
  force = false

[[redirects]]
  from = "/draco/*"
  to = "/draco/:splat"
  status = 200
  force = false

[[redirects]]
  from = "/static/*"
  to = "/static/:splat"
  status = 200
  force = false

# Catch-all: ALL other requests go to Remix function (must be LAST)
[[redirects]]
  from = "/*"
  to = "/.netlify/functions/server"
  status = 200

[dev]
  command = "npm run dev"
  targetPort = 8888
  publish = "build/client"
  autoLaunch = false


